@model PlantTwin.ViewModels.DashboardViewModel

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<h2 class="mb-4" style="color:white">Estado de la Línea de Producción</h2>

<div class="container-fluid">    

    <div class="row mt-3">
        @foreach(var m in Model.Machines)
        {
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">@m.Name</h5>
                        <p>
                            Estado:
                            @if (m.State.NombreEstado == "Fallo")
                            {
                                <span class="badge error">ERROR</span>
                            }
                            else
                            {
                                <span class="badge success">@m.State.NombreEstado</span>
                            }
                        </p>
                        <p>Temp: @m.Temperature.ToString("0.0") °C</p>
                        <p>RPM: @m.Rpm</p>
                        <p>Presión: @m.Pressure</p>

                        <form method="post" asp-action="Start">
                            <input type="hidden" name="id" value="@m.Id" />
                            <button class="btn btn-success">Iniciar</button>
                        </form>
                        <form method="post" asp-action="Stop" class="mt-1">
                            <input type="hidden" name="id" value="@m.Id" />
                            <button class="btn btn-danger">Detener</button>
                        </form>
                        <form method="post" asp-action="Clone" class="mt-1">
                            <input type="hidden" name="id" value="@m.Id" />
                            <button class="btn btn-secondary">Clonar</button>
                        </form>

                        <hr/>
                        <h6>Eventos recientes</h6>
                        <ul>
                            @foreach(var e in m.Events.TakeLast(5))
                            {
                                <li>@e.Timestamp.ToLocalTime().ToString("HH:mm:ss") - @e.Message</li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
<script>
    setTimeout(function(){
        location.reload();
    }, 3000);
</script>